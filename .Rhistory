library(iotc.base.common.plots)
p_load(knitr, data.table, qpcR, flextable, rmarkdown, bookdown, officer, magrittr, colorspace, tidyverse, iotc.base.common.plots)
if(!require(pacman)){
install.packages('pacman')
suppressPackageStartupMessages(library(pacman,quietly = TRUE))
}
p_load(knitr, data.table, qpcR, flextable, rmarkdown, bookdown, officer, magrittr, colorspace, tidyverse, iotc.base.common.plots)
setwd("initialization")
source("00_CORE.R")
setwd("..")
setwd("initialization")
source("00_CORE.R")
setwd("..")
render("FAOvsIOTC.Rmd",
output_format = "word_document2",
output_dir    = "outputs/"
)
render("FAOvsIOTC.Rmd",
output_format = "word_document2",
output_dir    = "outputs/"
)
render("FAOvsIOTC.Rmd",
output_format = "word_document2",
output_dir    = "outputs/"
)
# Source the R codes
setwd("initialization")
source("00_CORE.R")
NC_FAO_YEAR_FLEET_AREA   = NC_FAO [FLEET_CODE != "NEI", .(FAO  = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR = as.integer(YEAR), FLEET_CODE, FISHING_GROUND_CODE)]
NC_IOTC_YEAR_FLEET_AREA  = NC_IOTC[FLEET_CODE != "NEI", .(IOTC = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR, FLEET_CODE, FLEET, FISHING_GROUND_CODE, FISHING_GROUND)]
NC_IOTC_YEAR_FLEET_AREA
YEAR_FLEET_AREA_CATCH = merge.data.table(NC_FAO_YEAR_FLEET_AREA, NC_IOTC_YEAR_FLEET_AREA, by = c("YEAR", "FLEET_CODE", "FISHING_GROUND_CODE"), all = TRUE)
str(NC_IOTC_YEAR_FLEET_AREA)
str(NC_FAO_YEAR_FLEET_AREA)
NC_FAO_YEAR_FLEET_AREA   = NC_FAO [FLEET_CODE != "NEI", .(FAO  = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR = as.integer(YEAR), FLEET_CODE, FISHING_GROUND)]
NC_FAO_YEAR_FLEET_AREA
NC_FAO_YEAR_FLEET_AREA   = NC_FAO [FLEET_CODE != "NEI", .(FAO  = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR = as.integer(YEAR), FLEET_CODE, FISHING_GROUND)]
NC_IOTC_YEAR_FLEET_AREA  = NC_IOTC[FLEET_CODE != "NEI", .(IOTC = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR, FLEET_CODE, FLEET, FISHING_GROUND_CODE, FISHING_GROUND)]
YEAR_FLEET_AREA_CATCH = merge.data.table(NC_FAO_YEAR_FLEET_AREA, NC_IOTC_YEAR_FLEET_AREA, by = c("YEAR", "FLEET_CODE", "FISHING_GROUND"), all = TRUE)
YEAR_FLEET_AREA_CATCH
YEAR_FLEET_AREA_CATCH[, DIFFERENCE := FAO - IOTC]
YEAR_FLEET_AREA_CATCH[, DESCRIPTION := factor(fifelse(DIFFERENCE >= 0, "FAO>IOTC", "FAO<IOTC"), levels = c("FAO>IOTC", "FAO<IOTC"))]
setorderv(YEAR_FLEET_CATCH, cols = "DIFFERENCE")
setorderv(YEAR_FLEET_AREA_CATCH, cols = "DIFFERENCE")
YEAR_FLEET_AREA_CATCH = merge.data.table(NC_FAO_YEAR_FLEET_AREA, NC_IOTC_YEAR_FLEET_AREA, by = c("YEAR", "FLEET_CODE", "FISHING_GROUND"), all = TRUE)
YEAR_FLEET_AREA_CATCH[, DIFFERENCE := FAO - IOTC]
YEAR_FLEET_AREA_CATCH[, DESCRIPTION := factor(fifelse(DIFFERENCE >= 0, "FAO>IOTC", "FAO<IOTC"), levels = c("FAO>IOTC", "FAO<IOTC"))]
setorderv(YEAR_FLEET_AREA_CATCH, cols = "DIFFERENCE")
NC_FAO_YEAR_FLEET_AREA   = NC_FAO [FLEET_CODE != "NEI" & SPECIES_CODE == "YFT", .(FAO  = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR = as.integer(YEAR), FLEET_CODE, FISHING_GROUND)]
NC_IOTC_YEAR_FLEET_AREA  = NC_IOTC[FLEET_CODE != "NEI"  & SPECIES_CODE == "YFT", .(IOTC = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR, FLEET_CODE, FLEET, FISHING_GROUND_CODE, FISHING_GROUND)]
YEAR_FLEET_AREA_CATCH = merge.data.table(NC_FAO_YEAR_FLEET_AREA, NC_IOTC_YEAR_FLEET_AREA, by = c("YEAR", "FLEET_CODE", "FISHING_GROUND"), all = TRUE)
YEAR_FLEET_AREA_CATCH
YEAR_FLEET_AREA_CATCH[, DIFFERENCE := FAO - IOTC]
YEAR_FLEET_AREA_CATCH[, DESCRIPTION := factor(fifelse(DIFFERENCE >= 0, "FAO>IOTC", "FAO<IOTC"), levels = c("FAO>IOTC", "FAO<IOTC"))]
setorderv(YEAR_FLEET_AREA_CATCH, cols = "DIFFERENCE")
library(iotc.base.common.plots)
NC_YFT = NC_raw(species_codes = "YFT")
NC_FAO_YEAR_FLEET_AREA   = NC_FAO [FLEET_CODE != "NEI" & SPECIES_CODE == "YFT" & YEAR>2011, .(FAO  = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR = as.integer(YEAR), FLEET_CODE, FISHING_GROUND)]
NC_IOTC_YEAR_FLEET_AREA  = NC_IOTC[FLEET_CODE != "NEI"  & SPECIES_CODE == "YFT"  & YEAR>2011, .(IOTC = round(sum(CATCH, na.rm = TRUE))), keyby = .(YEAR, FLEET_CODE, FLEET, FISHING_GROUND_CODE, FISHING_GROUND)]
YEAR_FLEET_AREA_CATCH = merge.data.table(NC_FAO_YEAR_FLEET_AREA, NC_IOTC_YEAR_FLEET_AREA, by = c("YEAR", "FLEET_CODE", "FISHING_GROUND"), all = TRUE)
YEAR_FLEET_AREA_CATCH
YEAR_FLEET_AREA_CATCH = merge.data.table(NC_FAO_YEAR_FLEET_AREA, NC_IOTC_YEAR_FLEET_AREA, by = c("YEAR", "FLEET_CODE", "FISHING_GROUND"), all = TRUE)
YEAR_FLEET_AREA_CATCH[, DIFFERENCE := FAO - IOTC]
YEAR_FLEET_AREA_CATCH[, DESCRIPTION := factor(fifelse(DIFFERENCE >= 0, "FAO>IOTC", "FAO<IOTC"), levels = c("FAO>IOTC", "FAO<IOTC"))]
setorderv(YEAR_FLEET_AREA_CATCH, cols = "DIFFERENCE")
YEAR_FLEET_AREA_CATCH
FLEETS_WITH_LARGE_DIFFERENCES
#DIFFERENCE_UPPER_QUARTILE     = quantile(TOTAL_FLEET_CATCH$ABS_DIFFERENCE, 0.8, na.rm = T)
FLEETS_WITH_LARGE_DIFFERENCES = TOTAL_FLEET_CATCH[FLEET_CODE != "NEI" & ABS_DIFFERENCE >= 10000, FLEET_CODE]
FLEETS_WITH_LARGE_DIFFERENCES
YEAR_FLEET_AREA_YFT = merge.data.table(NC_FAO_YEAR_FLEET_AREA, NC_IOTC_YEAR_FLEET_AREA, by = c("YEAR", "FLEET_CODE", "FISHING_GROUND"), all = TRUE)
YEAR_FLEET_AREA_YFT[, DIFFERENCE := FAO - IOTC]
YEAR_FLEET_AREA_YFT[, DESCRIPTION := factor(fifelse(DIFFERENCE >= 0, "FAO>IOTC", "FAO<IOTC"), levels = c("FAO>IOTC", "FAO<IOTC"))]
setorderv(YEAR_FLEET_AREA_YFT, cols = "DIFFERENCE")
ggplot(data = YEAR_FLEET_AREA_YFT[FLEET_CODE %in% FLEETS_WITH_LARGE_DIFFERENCES], aes(x = YEAR, y = DIFFERENCE / 1000, fill = DESCRIPTION)) +
geom_col() +
scale_color_manual(values = NC_DIFF_COLORS_FILL) +
scale_fill_manual (values = NC_DIFF_COLORS_OUTLINE) +
theme_bw() +
xlab("") +
ylab("Difference between FAO and IOTC catch (x1,000 t)") +
theme(axis.text.x = element_text(size = 10),
axis.title.y = element_text(size = 9.5),
plot.margin = margin(.2, .3, .1, 0, "cm"),
legend.position = "bottom", legend.title = element_blank()) +
scale_y_continuous(labels = function(x) format(x, big.mark = ",")) +
facet_wrap(~FLEET_CODE) + #, scales = "free_y"
theme(strip.text = element_text(size = 10), strip.background = element_rect(fill = "white"))
